<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- $Header: 00001_edb360_323688_index v192 (2019-03-23) carlos.sierra $ -->
<!-- edb360_copyright (c) 2019, All rights reserved. -->
<!-- Author: carlos.sierra.usa@gmail.com -->

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="icon" href="edb360_favicon.ico" type="image/x-icon" />
<title>IOPS and MBPS Percentiles</title>

<style type="text/css">
body             {font:10pt Arial,Helvetica,Geneva,sans-serif; color:black; background:white;}
h1               {font-size:16pt; font-weight:bold; color:#336699; border-bottom:1px solid #336699; margin-top:0pt; margin-bottom:0pt; padding:0px 0px 0px 0px;}
h2               {font-size:14pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
h3               {font-size:12pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
pre              {font:8pt monospace,Monaco,"Courier New",Courier;}
a                {color:#663300;}
table            {font-size:8pt; border-collapse:collapse; empty-cells:show; white-space:nowrap; border:1px solid #336699;}
li               {font-size:8pt; color:black; padding-left:4px; padding-right:4px; padding-bottom:2px;}
th               {font-weight:bold; color:white; background:#0066CC; padding-left:4px; padding-right:4px; padding-bottom:2px;}
tr               {color:black; background:white;}
tr:hover         {color:white; background:#0066CC;}
tr.main          {color:black; background:white;}
tr.main:hover    {color:black; background:white;}
td               {vertical-align:top; border:1px solid #336699;}
td.c             {text-align:center;}
font.n           {font-size:8pt; font-style:italic; color:#336699;}
font.f           {font-size:8pt; color:#999999; border-top:1px solid #336699; margin-top:30pt;}
div.google-chart {width:809px; height:500px;}
</style>

<script type="text/javascript" src="sorttable.js"></script>

<!-- 00098_edb360_323688_1e_80_iops_and_mbps_percentiles.html $ -->
</head>
<body>
<h1> <a href="http://carlos-sierra.net/edb360-an-oracle-database-360-degree-view/" target="_blank"><img src="database.jpg" alt="eDB360" height="33" width="52" /></a> 1e.80. IOPS and MBPS Percentiles <em>(DBA_HIST_SYSSTAT)</em>  </h1>

<br />
I/O Operations per Second (IOPS) and I/O Mega Bytes per Second (MBPS). Includes Peak (max), percentiles and average for read (R), write (W) and read+write (RW) operations.
Memory is accounted as power of two (binary) while storage and network traffic as power of ten (decimal). <br />

<p>
<table class="sortable">
<tr>
<th scope="col">
#
</th>
<th scope="col">
DBID
</th>
<th scope="col">
Metric
</th>
<th scope="col">
Inst
<br>
Num
</th>
<th scope="col">
RW_IOPS
</th>
<th scope="col">
R_IOPS
</th>
<th scope="col">
W_IOPS
</th>
<th scope="col">
RW_MBPS
</th>
<th scope="col">
R_MBPS
</th>
<th scope="col">
W_MBPS
</th>
<th scope="col">
Begin Interval
</th>
<th scope="col">
End Interval
</th>
<th scope="col">
Snap
<br>
Shots
</th>
<th scope="col">
Days
<br>
Hist
</th>
<th scope="col">
Avg
<br>
Snaps
<br>
per
<br>
Day
</th>
</tr>
<tr>
<td>
1
</td>
<td align="right">
          2109323688
</td>
<td>
Maximum or peak
</td>
<td align="right">
    1
</td>
<td align="right">
                6248
</td>
<td align="right">
                5558
</td>
<td align="right">
                1678
</td>
<td align="right">
                 761
</td>
<td align="right">
                 759
</td>
<td align="right">
                 165
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
2
</td>
<td align="right">
          2109323688
</td>
<td>
Maximum or peak
</td>
<td align="right">
    2
</td>
<td align="right">
                6447
</td>
<td align="right">
                5787
</td>
<td align="right">
                2176
</td>
<td align="right">
                 547
</td>
<td align="right">
                 547
</td>
<td align="right">
                 218
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
3
</td>
<td align="right">
          2109323688
</td>
<td>
Maximum or peak
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
               10334
</td>
<td align="right">
                9997
</td>
<td align="right">
                3853
</td>
<td align="right">
                1035
</td>
<td align="right">
                1027
</td>
<td align="right">
                 254
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
4
</td>
<td align="right">
          2109323688
</td>
<td>
99.9th percentl
</td>
<td align="right">
    1
</td>
<td align="right">
                6186
</td>
<td align="right">
                5389
</td>
<td align="right">
                1407
</td>
<td align="right">
                 745
</td>
<td align="right">
                 741
</td>
<td align="right">
                 155
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
5
</td>
<td align="right">
          2109323688
</td>
<td>
99.9th percentl
</td>
<td align="right">
    2
</td>
<td align="right">
                5947
</td>
<td align="right">
                5303
</td>
<td align="right">
                1333
</td>
<td align="right">
                 447
</td>
<td align="right">
                 396
</td>
<td align="right">
                 132
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
6
</td>
<td align="right">
          2109323688
</td>
<td>
99.9th percentl
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                9891
</td>
<td align="right">
                8621
</td>
<td align="right">
                2109
</td>
<td align="right">
                 843
</td>
<td align="right">
                 839
</td>
<td align="right">
                 225
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
7
</td>
<td align="right">
          2109323688
</td>
<td>
99th percentile
</td>
<td align="right">
    1
</td>
<td align="right">
                4196
</td>
<td align="right">
                3871
</td>
<td align="right">
                 772
</td>
<td align="right">
                 616
</td>
<td align="right">
                 590
</td>
<td align="right">
                 104
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
8
</td>
<td align="right">
          2109323688
</td>
<td>
99th percentile
</td>
<td align="right">
    2
</td>
<td align="right">
                4707
</td>
<td align="right">
                4009
</td>
<td align="right">
                 972
</td>
<td align="right">
                 276
</td>
<td align="right">
                 257
</td>
<td align="right">
                 112
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
9
</td>
<td align="right">
          2109323688
</td>
<td>
99th percentile
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                8448
</td>
<td align="right">
                7139
</td>
<td align="right">
                1373
</td>
<td align="right">
                 661
</td>
<td align="right">
                 619
</td>
<td align="right">
                 130
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
10
</td>
<td align="right">
          2109323688
</td>
<td>
97th percentile
</td>
<td align="right">
    1
</td>
<td align="right">
                3487
</td>
<td align="right">
                3252
</td>
<td align="right">
                 541
</td>
<td align="right">
                 503
</td>
<td align="right">
                 489
</td>
<td align="right">
                  85
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
11
</td>
<td align="right">
          2109323688
</td>
<td>
97th percentile
</td>
<td align="right">
    2
</td>
<td align="right">
                3785
</td>
<td align="right">
                3326
</td>
<td align="right">
                 677
</td>
<td align="right">
                 198
</td>
<td align="right">
                 153
</td>
<td align="right">
                 100
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
12
</td>
<td align="right">
          2109323688
</td>
<td>
97th percentile
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                6516
</td>
<td align="right">
                5705
</td>
<td align="right">
                1072
</td>
<td align="right">
                 557
</td>
<td align="right">
                 530
</td>
<td align="right">
                 114
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
13
</td>
<td align="right">
          2109323688
</td>
<td>
95th percentile
</td>
<td align="right">
    1
</td>
<td align="right">
                3207
</td>
<td align="right">
                2989
</td>
<td align="right">
                 409
</td>
<td align="right">
                 365
</td>
<td align="right">
                 355
</td>
<td align="right">
                  50
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
14
</td>
<td align="right">
          2109323688
</td>
<td>
95th percentile
</td>
<td align="right">
    2
</td>
<td align="right">
                3324
</td>
<td align="right">
                3058
</td>
<td align="right">
                 572
</td>
<td align="right">
                 188
</td>
<td align="right">
                 117
</td>
<td align="right">
                  95
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
15
</td>
<td align="right">
          2109323688
</td>
<td>
95th percentile
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                5533
</td>
<td align="right">
                4957
</td>
<td align="right">
                 854
</td>
<td align="right">
                 478
</td>
<td align="right">
                 454
</td>
<td align="right">
                 105
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
16
</td>
<td align="right">
          2109323688
</td>
<td>
90th percentile
</td>
<td align="right">
    1
</td>
<td align="right">
                2693
</td>
<td align="right">
                2476
</td>
<td align="right">
                 243
</td>
<td align="right">
                 202
</td>
<td align="right">
                 159
</td>
<td align="right">
                  13
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
17
</td>
<td align="right">
          2109323688
</td>
<td>
90th percentile
</td>
<td align="right">
    2
</td>
<td align="right">
                2877
</td>
<td align="right">
                2682
</td>
<td align="right">
                 384
</td>
<td align="right">
                 156
</td>
<td align="right">
                  83
</td>
<td align="right">
                  59
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
18
</td>
<td align="right">
          2109323688
</td>
<td>
90th percentile
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                4387
</td>
<td align="right">
                4108
</td>
<td align="right">
                 584
</td>
<td align="right">
                 298
</td>
<td align="right">
                 225
</td>
<td align="right">
                  91
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
19
</td>
<td align="right">
          2109323688
</td>
<td>
75th percentile
</td>
<td align="right">
    1
</td>
<td align="right">
                1658
</td>
<td align="right">
                1554
</td>
<td align="right">
                  82
</td>
<td align="right">
                  72
</td>
<td align="right">
                  58
</td>
<td align="right">
                   3
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
20
</td>
<td align="right">
          2109323688
</td>
<td>
75th percentile
</td>
<td align="right">
    2
</td>
<td align="right">
                1965
</td>
<td align="right">
                1750
</td>
<td align="right">
                 103
</td>
<td align="right">
                  46
</td>
<td align="right">
                  34
</td>
<td align="right">
                   4
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
21
</td>
<td align="right">
          2109323688
</td>
<td>
75th percentile
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                3202
</td>
<td align="right">
                2980
</td>
<td align="right">
                 224
</td>
<td align="right">
                 170
</td>
<td align="right">
                 120
</td>
<td align="right">
                  18
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
22
</td>
<td align="right">
          2109323688
</td>
<td>
Median
</td>
<td align="right">
    1
</td>
<td align="right">
                 731
</td>
<td align="right">
                 658
</td>
<td align="right">
                  42
</td>
<td align="right">
                  20
</td>
<td align="right">
                  18
</td>
<td align="right">
                   1
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
23
</td>
<td align="right">
          2109323688
</td>
<td>
Median
</td>
<td align="right">
    2
</td>
<td align="right">
                 737
</td>
<td align="right">
                 672
</td>
<td align="right">
                  47
</td>
<td align="right">
                  14
</td>
<td align="right">
                  12
</td>
<td align="right">
                   1
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
24
</td>
<td align="right">
          2109323688
</td>
<td>
Median
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                1994
</td>
<td align="right">
                1859
</td>
<td align="right">
                 106
</td>
<td align="right">
                  45
</td>
<td align="right">
                  38
</td>
<td align="right">
                   3
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
25
</td>
<td align="right">
          2109323688
</td>
<td>
Average
</td>
<td align="right">
    1
</td>
<td align="right">
                1115
</td>
<td align="right">
                1022
</td>
<td align="right">
                  93
</td>
<td align="right">
                  74
</td>
<td align="right">
                  67
</td>
<td align="right">
                   7
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
26
</td>
<td align="right">
          2109323688
</td>
<td>
Average
</td>
<td align="right">
    2
</td>
<td align="right">
                1214
</td>
<td align="right">
                1094
</td>
<td align="right">
                 120
</td>
<td align="right">
                  44
</td>
<td align="right">
                  31
</td>
<td align="right">
                  13
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
<tr>
<td>
27
</td>
<td align="right">
          2109323688
</td>
<td>
Average
</td>
<td align="right">
&nbsp;
</td>
<td align="right">
                2329
</td>
<td align="right">
                2116
</td>
<td align="right">
                 213
</td>
<td align="right">
                 118
</td>
<td align="right">
                  98
</td>
<td align="right">
                  20
</td>
<td>
2020-10-06 12:00:1
4
</td>
<td>
2020-11-06 11:00:1
6
</td>
<td align="right">
  1487
</td>
<td align="right">
  31.0
</td>
<td align="right">
  48.0
</td>
</tr>
</table>
<p>


Consider Peak or high Percentile for sizing. Instance Number -1 means aggregated values (SUM) while -2 means over all instances (combined).
<br />
#: click on a column heading to sort on it

<pre>
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 SNAP_ID                                   NOT NULL NUMBER
 DBID                                      NOT NULL NUMBER
 INSTANCE_NUMBER                           NOT NULL NUMBER
 STAT_ID                                   NOT NULL NUMBER
 STAT_NAME                                 NOT NULL VARCHAR2(64)
 VALUE                                              NUMBER
 CON_DBID                                           NUMBER
 CON_ID                                             NUMBER

WITH
sysstat_io AS (
SELECT /*+  MATERIALIZE NO_MERGE  */ /* 1e.80 */
       h.snap_id,
       h.dbid,
       h.instance_number,
       SUM(CASE WHEN h.stat_name = 'physical read total IO requests' THEN value ELSE 0 END) r_reqs,
       SUM(CASE WHEN h.stat_name IN ('physical write total IO requests', 'redo writes') THEN value ELSE 0 END) w_reqs,
       SUM(CASE WHEN h.stat_name = 'physical read total bytes' THEN value ELSE 0 END) r_bytes,
       SUM(CASE WHEN h.stat_name IN ('physical write total bytes', 'redo size') THEN value ELSE 0 END) w_bytes
  FROM dba_hist_sysstat h
 WHERE h.snap_id BETWEEN 3473 AND 4962
   AND h.dbid = 2109323688
   AND h.stat_name IN ('physical read total IO requests', 'physical write total IO requests', 'redo writes', 'physical read total bytes', 'physical write total bytes', 'redo size')
 GROUP BY
       h.snap_id,
       h.dbid,
       h.instance_number
),
io_per_inst_and_snap_id AS (
SELECT /*+  MATERIALIZE NO_MERGE  */ /* 1e.80 */
       h1.dbid,
       h1.instance_number,
       h1.snap_id,
       (h1.r_reqs - h0.r_reqs) r_reqs,
       (h1.w_reqs - h0.w_reqs) w_reqs,
       (h1.r_bytes - h0.r_bytes) r_bytes,
       (h1.w_bytes - h0.w_bytes) w_bytes,
       (CAST(s1.end_interval_time AS DATE) - CAST(s1.begin_interval_time AS DATE)) * 86400 elapsed_sec,
       CAST(s1.begin_interval_time AS DATE) begin_interval_time,
       CAST(s1.end_interval_time AS DATE) end_interval_time
  FROM sysstat_io h0,
       dba_hist_snapshot s0,
       sysstat_io h1,
       dba_hist_snapshot s1
 WHERE s0.snap_id = h0.snap_id
   AND s0.dbid = h0.dbid
   AND s0.instance_number = h0.instance_number
   AND h1.snap_id = h0.snap_id + 1
   AND h1.dbid = h0.dbid
   AND h1.instance_number = h0.instance_number
   AND s1.snap_id = h1.snap_id
   AND s1.dbid = h1.dbid
   AND s1.instance_number = h1.instance_number
   AND s1.snap_id = s0.snap_id + 1
   AND s1.dbid = s0.dbid
   AND s1.instance_number = s0.instance_number
   AND s1.startup_time = s0.startup_time
),
io_per_snap_id AS (
SELECT dbid,
       snap_id,
       SUM(r_reqs) r_reqs,
       SUM(w_reqs) w_reqs,
       SUM(r_bytes) r_bytes,
       SUM(w_bytes) w_bytes,
       AVG(elapsed_sec) elapsed_sec,
       MIN(begin_interval_time) begin_interval_time,
       MAX(end_interval_time) end_interval_time
  FROM io_per_inst_and_snap_id
 GROUP BY
       dbid,
       snap_id
),
io_per_inst AS (
SELECT dbid,
       instance_number,
       MIN(begin_interval_time) begin_interval_time,
       MAX(end_interval_time) end_interval_time,
       COUNT(DISTINCT snap_id) snap_shots,
       ROUND(100 * SUM(r_reqs) / (SUM(r_reqs) + SUM(w_reqs)), 1) r_reqs_perc,
       ROUND(100 * SUM(w_reqs) / (SUM(r_reqs) + SUM(w_reqs)), 1) w_reqs_perc,
       ROUND(MAX((r_reqs + w_reqs) / elapsed_sec)) rw_iops_peak,
       ROUND(MAX(r_reqs / elapsed_sec)) r_iops_peak,
       ROUND(MAX(w_reqs / elapsed_sec)) w_iops_peak,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_999,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_99,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_97,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_95,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_90,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_75,
       ROUND(MEDIAN((r_reqs + w_reqs) / elapsed_sec)) rw_iops_med,
       ROUND(MEDIAN(r_reqs / elapsed_sec)) r_iops_med,
       ROUND(MEDIAN(w_reqs / elapsed_sec)) w_iops_med,
       ROUND(AVG((r_reqs + w_reqs) / elapsed_sec)) rw_iops_avg,
       ROUND(AVG(r_reqs / elapsed_sec)) r_iops_avg,
       ROUND(AVG(w_reqs / elapsed_sec)) w_iops_avg,
       ROUND(100 * SUM(r_bytes) / (SUM(r_bytes) + SUM(w_bytes)), 1) r_bytes_perc,
       ROUND(100 * SUM(w_bytes) / (SUM(r_bytes) + SUM(w_bytes)), 1) w_bytes_perc,
       ROUND(MAX((r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_peak,
       ROUND(MAX(r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_peak,
       ROUND(MAX(w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_peak,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_999,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_99,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_97,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_95,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_90,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_75,
       ROUND(MEDIAN((r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_med,
       ROUND(MEDIAN(r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_med,
       ROUND(MEDIAN(w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_med,
       ROUND(AVG((r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_avg,
       ROUND(AVG(r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_avg,
       ROUND(AVG(w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_avg
  FROM io_per_inst_and_snap_id
 WHERE elapsed_sec &gt; 60 -- ignore snaps too close
 GROUP BY
       dbid,
       instance_number
),
io_per_cluster AS ( -- combined
SELECT dbid,
       TO_NUMBER(NULL) instance_number,
       MIN(begin_interval_time) begin_interval_time,
       MAX(end_interval_time) end_interval_time,
       COUNT(DISTINCT snap_id) snap_shots,
       ROUND(100 * SUM(r_reqs) / (SUM(r_reqs) + SUM(w_reqs)), 1) r_reqs_perc,
       ROUND(100 * SUM(w_reqs) / (SUM(r_reqs) + SUM(w_reqs)), 1) w_reqs_perc,
       ROUND(MAX((r_reqs + w_reqs) / elapsed_sec)) rw_iops_peak,
       ROUND(MAX(r_reqs / elapsed_sec)) r_iops_peak,
       ROUND(MAX(w_reqs / elapsed_sec)) w_iops_peak,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_999,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_99,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_97,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_95,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_90,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY (r_reqs + w_reqs) / elapsed_sec)) rw_iops_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY r_reqs / elapsed_sec)) r_iops_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY w_reqs / elapsed_sec)) w_iops_75,
       ROUND(MEDIAN((r_reqs + w_reqs) / elapsed_sec)) rw_iops_med,
       ROUND(MEDIAN(r_reqs / elapsed_sec)) r_iops_med,
       ROUND(MEDIAN(w_reqs / elapsed_sec)) w_iops_med,
       ROUND(AVG((r_reqs + w_reqs) / elapsed_sec)) rw_iops_avg,
       ROUND(AVG(r_reqs / elapsed_sec)) r_iops_avg,
       ROUND(AVG(w_reqs / elapsed_sec)) w_iops_avg,
       ROUND(100 * SUM(r_bytes) / (SUM(r_bytes) + SUM(w_bytes)), 1) r_bytes_perc,
       ROUND(100 * SUM(w_bytes) / (SUM(r_bytes) + SUM(w_bytes)), 1) w_bytes_perc,
       ROUND(MAX((r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_peak,
       ROUND(MAX(r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_peak,
       ROUND(MAX(w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_peak,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_999,
       ROUND(PERCENTILE_DISC(0.999) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_999,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_99,
       ROUND(PERCENTILE_DISC(0.99) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_99,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_97,
       ROUND(PERCENTILE_DISC(0.97) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_97,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_95,
       ROUND(PERCENTILE_DISC(0.95) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_95,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_90,
       ROUND(PERCENTILE_DISC(0.90) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_90,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY (r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_75,
       ROUND(PERCENTILE_DISC(0.75) WITHIN GROUP (ORDER BY w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_75,
       ROUND(MEDIAN((r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_med,
       ROUND(MEDIAN(r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_med,
       ROUND(MEDIAN(w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_med,
       ROUND(AVG((r_bytes + w_bytes) / POWER(10,6) / elapsed_sec)) rw_mbps_avg,
       ROUND(AVG(r_bytes / POWER(10,6) / elapsed_sec)) r_mbps_avg,
       ROUND(AVG(w_bytes / POWER(10,6) / elapsed_sec)) w_mbps_avg
  FROM io_per_snap_id
 WHERE elapsed_sec &gt; 60 -- ignore snaps too close
 GROUP BY
       dbid
),
io_per_inst_or_cluster AS (
SELECT dbid, 01 order_by, 'Maximum or peak' metric, instance_number, rw_iops_peak rw_iops, r_iops_peak r_iops, w_iops_peak w_iops, rw_mbps_peak rw_mbps, r_mbps_peak r_mbps, w_mbps_peak w_mbps, begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 02 order_by, '99.9th percentl' metric, instance_number, rw_iops_999 rw_iops,  r_iops_999 r_iops,  w_iops_999 w_iops,  rw_mbps_999 rw_mbps,  r_mbps_999 r_mbps,  w_mbps_999 w_mbps,  begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 03 order_by, '99th percentile' metric, instance_number, rw_iops_99 rw_iops,   r_iops_99 r_iops,   w_iops_99 w_iops,   rw_mbps_99 rw_mbps,   r_mbps_99 r_mbps,   w_mbps_99 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 04 order_by, '97th percentile' metric, instance_number, rw_iops_97 rw_iops,   r_iops_97 r_iops,   w_iops_97 w_iops,   rw_mbps_97 rw_mbps,   r_mbps_97 r_mbps,   w_mbps_97 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 05 order_by, '95th percentile' metric, instance_number, rw_iops_95 rw_iops,   r_iops_95 r_iops,   w_iops_95 w_iops,   rw_mbps_95 rw_mbps,   r_mbps_95 r_mbps,   w_mbps_95 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 06 order_by, '90th percentile' metric, instance_number, rw_iops_90 rw_iops,   r_iops_90 r_iops,   w_iops_90 w_iops,   rw_mbps_90 rw_mbps,   r_mbps_90 r_mbps,   w_mbps_90 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 07 order_by, '75th percentile' metric, instance_number, rw_iops_75 rw_iops,   r_iops_75 r_iops,   w_iops_75 w_iops,   rw_mbps_75 rw_mbps,   r_mbps_75 r_mbps,   w_mbps_75 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 08 order_by, 'Median'          metric, instance_number, rw_iops_med rw_iops,  r_iops_med r_iops,  w_iops_med w_iops,  rw_mbps_med rw_mbps,  r_mbps_med r_mbps,  w_mbps_med w_mbps,  begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 09 order_by, 'Average'         metric, instance_number, rw_iops_avg rw_iops,  r_iops_avg r_iops,  w_iops_avg w_iops,  rw_mbps_avg rw_mbps,  r_mbps_avg r_mbps,  w_mbps_avg w_mbps,  begin_interval_time, end_interval_time, snap_shots FROM io_per_inst
 UNION ALL
SELECT dbid, 01 order_by, 'Maximum or peak' metric, instance_number, rw_iops_peak rw_iops, r_iops_peak r_iops, w_iops_peak w_iops, rw_mbps_peak rw_mbps, r_mbps_peak r_mbps, w_mbps_peak w_mbps, begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 02 order_by, '99.9th percentl' metric, instance_number, rw_iops_999 rw_iops,  r_iops_999 r_iops,  w_iops_999 w_iops,  rw_mbps_999 rw_mbps,  r_mbps_999 r_mbps,  w_mbps_999 w_mbps,  begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 03 order_by, '99th percentile' metric, instance_number, rw_iops_99 rw_iops,   r_iops_99 r_iops,   w_iops_99 w_iops,   rw_mbps_99 rw_mbps,   r_mbps_99 r_mbps,   w_mbps_99 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 04 order_by, '97th percentile' metric, instance_number, rw_iops_97 rw_iops,   r_iops_97 r_iops,   w_iops_97 w_iops,   rw_mbps_97 rw_mbps,   r_mbps_97 r_mbps,   w_mbps_97 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 05 order_by, '95th percentile' metric, instance_number, rw_iops_95 rw_iops,   r_iops_95 r_iops,   w_iops_95 w_iops,   rw_mbps_95 rw_mbps,   r_mbps_95 r_mbps,   w_mbps_95 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 06 order_by, '90th percentile' metric, instance_number, rw_iops_90 rw_iops,   r_iops_90 r_iops,   w_iops_90 w_iops,   rw_mbps_90 rw_mbps,   r_mbps_90 r_mbps,   w_mbps_90 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 07 order_by, '75th percentile' metric, instance_number, rw_iops_75 rw_iops,   r_iops_75 r_iops,   w_iops_75 w_iops,   rw_mbps_75 rw_mbps,   r_mbps_75 r_mbps,   w_mbps_75 w_mbps,   begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 08 order_by, 'Median'          metric, instance_number, rw_iops_med rw_iops,  r_iops_med r_iops,  w_iops_med w_iops,  rw_mbps_med rw_mbps,  r_mbps_med r_mbps,  w_mbps_med w_mbps,  begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
 UNION ALL
SELECT dbid, 09 order_by, 'Average'         metric, instance_number, rw_iops_avg rw_iops,  r_iops_avg r_iops,  w_iops_avg w_iops,  rw_mbps_avg rw_mbps,  r_mbps_avg r_mbps,  w_mbps_avg w_mbps,  begin_interval_time, end_interval_time, snap_shots FROM io_per_cluster
)
SELECT dbid,
       metric,
       instance_number,
       rw_iops,
       r_iops,
       w_iops,
       rw_mbps,
       r_mbps,
       w_mbps,
       TO_CHAR(CAST(begin_interval_time AS DATE), 'YYYY-MM-DD HH24:MI:SS') begin_interval_time,
       TO_CHAR(CAST(end_interval_time AS DATE), 'YYYY-MM-DD HH24:MI:SS') end_interval_time,
       snap_shots,
       ROUND(CAST(end_interval_time AS DATE) - CAST(begin_interval_time AS DATE), 1) days,
       ROUND(snap_shots / (CAST(end_interval_time AS DATE) - CAST(begin_interval_time AS DATE)), 1) avg_snaps_per_day
  FROM io_per_inst_or_cluster
 ORDER BY
       dbid,
       order_by,
       instance_number NULLS LAST;

27 rows selected.
</pre>

<br />
<font class="f">edb360 (c) 2019. Version v192 (2019-03-23). Timestamp: 2020-11-06T11:30:20  </font>
</body>
</html>
