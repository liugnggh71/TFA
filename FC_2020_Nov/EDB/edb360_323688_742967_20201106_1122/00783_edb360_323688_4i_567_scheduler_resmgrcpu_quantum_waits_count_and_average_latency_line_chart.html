<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- $Header: 00001_edb360_323688_index v192 (2019-03-23) carlos.sierra $ -->
<!-- edb360_copyright (c) 2019, All rights reserved. -->
<!-- Author: carlos.sierra.usa@gmail.com -->

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="icon" href="edb360_favicon.ico" type="image/x-icon" />
<title>Scheduler "resmgr:cpu quantum" Waits Count and Average Latency</title>

<style type="text/css">
body             {font:10pt Arial,Helvetica,Geneva,sans-serif; color:black; background:white;}
h1               {font-size:16pt; font-weight:bold; color:#336699; border-bottom:1px solid #336699; margin-top:0pt; margin-bottom:0pt; padding:0px 0px 0px 0px;}
h2               {font-size:14pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
h3               {font-size:12pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
pre              {font:8pt monospace,Monaco,"Courier New",Courier;}
a                {color:#663300;}
table            {font-size:8pt; border-collapse:collapse; empty-cells:show; white-space:nowrap; border:1px solid #336699;}
li               {font-size:8pt; color:black; padding-left:4px; padding-right:4px; padding-bottom:2px;}
th               {font-weight:bold; color:white; background:#0066CC; padding-left:4px; padding-right:4px; padding-bottom:2px;}
tr               {color:black; background:white;}
tr:hover         {color:white; background:#0066CC;}
tr.main          {color:black; background:white;}
tr.main:hover    {color:black; background:white;}
td               {vertical-align:top; border:1px solid #336699;}
td.c             {text-align:center;}
font.n           {font-size:8pt; font-style:italic; color:#336699;}
font.f           {font-size:8pt; color:#999999; border-top:1px solid #336699; margin-top:30pt;}
div.google-chart {width:809px; height:500px;}
</style>

<!-- 00783_edb360_323688_4i_567_scheduler_resmgrcpu_quantum_waits_count_and_average_latency_line_chart.html $ -->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("visualization", "1", {packages:["corechart"]})
google.setOnLoadCallback(drawChart)
function drawChart() {
var data = google.visualization.arrayToDataTable([
['Date', 'Waits Count', 'Average Latency']
, [new Date(2020,9,06,18,30,16), 420, 7.16]
, [new Date(2020,9,06,19,00,18), 2873, 11.281]
, [new Date(2020,9,06,19,30,21), 131478, 31.708]
, [new Date(2020,9,06,20,00,24), 25037, 29.267]
, [new Date(2020,9,06,20,30,01), 6611, 9.992]
, [new Date(2020,9,06,21,00,04), 1514, 4.602]
, [new Date(2020,9,07,18,30,13), 4, .75]
, [new Date(2020,9,07,19,00,16), 868, 4.789]
, [new Date(2020,9,07,19,30,02), 50495, 10.325]
, [new Date(2020,9,07,20,00,05), 2044, 3.229]
, [new Date(2020,9,07,20,30,08), 3013, 3.314]
, [new Date(2020,9,07,21,00,12), 933, 2.852]
, [new Date(2020,9,08,18,30,11), 19, 1.211]
, [new Date(2020,9,08,19,00,02), 1080, 3.26]
, [new Date(2020,9,08,19,30,06), 91531, 26.941]
, [new Date(2020,9,08,20,00,10), 2179, 2.49]
, [new Date(2020,9,08,20,30,14), 11785, 6.402]
, [new Date(2020,9,08,21,00,17), 880, 2.794]
, [new Date(2020,9,09,19,00,11), 6397, 29.126]
, [new Date(2020,9,09,19,30,14), 75898, 15.584]
, [new Date(2020,9,09,20,00,17), 19630, 19.31]
, [new Date(2020,9,09,20,30,20), 9183, 14.799]
, [new Date(2020,9,09,21,00,22), 10465, 6.708]
, [new Date(2020,9,10,19,00,13), 3248, 5]
, [new Date(2020,9,10,19,30,16), 9361, 7.743]
, [new Date(2020,9,10,20,00,18), 9522, 10.021]
, [new Date(2020,9,10,20,30,21), 957, 4.179]
, [new Date(2020,9,10,21,00,24), 4347, 5.456]
, [new Date(2020,9,10,21,30,26), 1161, 3.246]
, [new Date(2020,9,11,03,30,31), 72, 24.653]
, [new Date(2020,9,11,04,00,33), 2, 1]
, [new Date(2020,9,11,19,00,14), 4109, 5.515]
, [new Date(2020,9,11,19,30,04), 17469, 8.619]
, [new Date(2020,9,11,20,00,09), 14045, 4.305]
, [new Date(2020,9,11,20,30,14), 1731, 6.494]
, [new Date(2020,9,11,21,00,17), 4121, 5.467]
, [new Date(2020,9,11,21,30,21), 3514, 7.188]
, [new Date(2020,9,11,22,00,23), 201, 5.483]
, [new Date(2020,9,12,19,00,19), 13658, 21.747]
, [new Date(2020,9,12,19,30,22), 3833, 25.259]
, [new Date(2020,9,12,20,00,25), 30559, 10.535]
, [new Date(2020,9,12,20,30,27), 8246, 6.265]
, [new Date(2020,9,12,21,00,30), 794, 3.764]
, [new Date(2020,9,13,18,30,22), 1, .5]
, [new Date(2020,9,13,19,00,03), 66907, 65.357]
, [new Date(2020,9,13,19,30,13), 142233, 38.625]
, [new Date(2020,9,13,20,00,20), 118110, 29.78]
, [new Date(2020,9,13,20,30,25), 9069, 31.387]
, [new Date(2020,9,13,21,00,29), 8077, 7.732]
, [new Date(2020,9,14,18,30,25), 475, 7.527]
, [new Date(2020,9,14,19,00,29), 17068, 52.156]
, [new Date(2020,9,14,19,30,32), 13663, 24.506]
, [new Date(2020,9,14,20,00,35), 17178, 5.863]
, [new Date(2020,9,14,20,30,38), 2985, 2.569]
, [new Date(2020,9,14,21,00,40), 2974, 2.447]
, [new Date(2020,9,15,19,00,08), 16124, 19.161]
, [new Date(2020,9,15,19,30,13), 113651, 28.938]
, [new Date(2020,9,15,20,00,19), 17006, 23.353]
, [new Date(2020,9,15,20,30,23), 24359, 6.824]
, [new Date(2020,9,15,21,00,27), 10214, 5.479]
, [new Date(2020,9,16,18,00,22), 1, 384]
, [new Date(2020,9,16,18,30,25), 28, 4491.313]
, [new Date(2020,9,16,19,00,28), 47579, 2.911]
, [new Date(2020,9,16,19,30,33), 28438, 10.355]
, [new Date(2020,9,16,20,00,37), 3115, 2.717]
, [new Date(2020,9,16,20,30,40), 832, 2.442]
, [new Date(2020,9,16,21,00,45), 8372, 7.21]
, [new Date(2020,9,17,05,30,35), 12, .875]
, [new Date(2020,9,17,19,00,00), 1551, 2.268]
, [new Date(2020,9,17,19,30,04), 23628, 4.086]
, [new Date(2020,9,17,20,00,00), 2061, 4.025]
, [new Date(2020,9,17,20,30,02), 4141, 4.749]
, [new Date(2020,9,17,21,00,04), 359, 2.515]
, [new Date(2020,9,18,19,00,18), 347, 8.065]
, [new Date(2020,9,18,19,30,20), 14924, 11.34]
, [new Date(2020,9,18,20,00,22), 3686, 5.024]
, [new Date(2020,9,18,20,30,25), 7686, 2.852]
, [new Date(2020,9,18,21,00,27), 1363, 2.392]
, [new Date(2020,9,19,19,00,13), 350, 3.99]
, [new Date(2020,9,19,19,30,16), 43866, 21.052]
, [new Date(2020,9,19,20,00,19), 18761, 7.344]
, [new Date(2020,9,19,20,30,22), 4193, 4.171]
, [new Date(2020,9,19,21,00,25), 2938, 3.834]
, [new Date(2020,9,20,19,00,09), 1403, 3.2]
, [new Date(2020,9,20,19,30,12), 14304, 5.379]
, [new Date(2020,9,20,20,00,15), 52520, 15.419]
, [new Date(2020,9,20,20,30,18), 5741, 4.354]
, [new Date(2020,9,20,21,00,21), 8352, 6.874]
, [new Date(2020,9,21,18,30,14), 19, 2.711]
, [new Date(2020,9,21,19,00,01), 2175, 5.867]
, [new Date(2020,9,21,19,30,04), 26077, 5.679]
, [new Date(2020,9,21,20,00,06), 23157, 25.83]
, [new Date(2020,9,21,20,30,09), 6272, 13.017]
, [new Date(2020,9,21,21,00,11), 4736, 3.92]
, [new Date(2020,9,22,19,00,09), 3599, 13.317]
, [new Date(2020,9,22,19,30,14), 27993, 6.713]
, [new Date(2020,9,22,20,00,18), 66970, 25.833]
, [new Date(2020,9,22,20,30,21), 1972, 2.214]
, [new Date(2020,9,22,21,00,00), 13761, 10.111]
, [new Date(2020,9,23,18,30,45), 14, 1.464]
, [new Date(2020,9,23,19,00,01), 1388, 3.946]
, [new Date(2020,9,23,19,30,05), 28358, 14.082]
, [new Date(2020,9,23,20,00,08), 20682, 13.354]
, [new Date(2020,9,23,20,30,00), 4485, 2.773]
, [new Date(2020,9,23,21,00,03), 2998, 2.686]
, [new Date(2020,9,24,15,00,27), 747, 4.234]
, [new Date(2020,9,24,15,30,31), 168, 2.732]
, [new Date(2020,9,24,18,30,50), 1921, 6.339]
, [new Date(2020,9,24,19,00,54), 20929, 7.311]
, [new Date(2020,9,24,19,30,57), 56496, 8.817]
, [new Date(2020,9,24,20,00,02), 83680, 7.44]
, [new Date(2020,9,24,20,30,01), 16672, 5.887]
, [new Date(2020,9,24,21,00,04), 52570, 8.106]
, [new Date(2020,9,24,21,30,06), 17338, 7.308]
, [new Date(2020,9,25,05,30,41), 10078, 8.95]
, [new Date(2020,9,25,06,00,44), 5, .5]
, [new Date(2020,9,25,18,30,39), 716, 5.971]
, [new Date(2020,9,25,19,00,42), 20733, 6.751]
, [new Date(2020,9,25,19,30,46), 52671, 8.05]
, [new Date(2020,9,25,20,00,51), 83699, 8.211]
, [new Date(2020,9,25,20,30,54), 18837, 5.865]
, [new Date(2020,9,25,21,00,59), 52054, 9.116]
, [new Date(2020,9,25,21,30,01), 22391, 13.418]
, [new Date(2020,9,25,22,00,03), 116, 6.797]
, [new Date(2020,9,26,18,30,33), 390, 4.769]
, [new Date(2020,9,26,19,00,36), 21428, 6.963]
, [new Date(2020,9,26,19,30,41), 68624, 16.253]
, [new Date(2020,9,26,20,00,45), 89296, 10.201]
, [new Date(2020,9,26,20,30,49), 25800, 7.914]
, [new Date(2020,9,26,21,00,53), 48110, 10.025]
, [new Date(2020,9,27,18,30,35), 326, 5.379]
, [new Date(2020,9,27,19,00,37), 40155, 16.365]
, [new Date(2020,9,27,19,30,39), 64878, 11.503]
, [new Date(2020,9,27,20,00,06), 140794, 76.851]
, [new Date(2020,9,27,20,30,11), 26146, 50.044]
, [new Date(2020,9,27,21,00,16), 15135, 8.205]
, [new Date(2020,9,28,18,30,07), 341, 20.016]
, [new Date(2020,9,28,19,00,11), 27511, 9.236]
, [new Date(2020,9,28,19,30,15), 101357, 35.976]
, [new Date(2020,9,28,20,00,21), 92252, 24.102]
, [new Date(2020,9,28,20,30,24), 28039, 8.001]
, [new Date(2020,9,28,21,00,28), 54835, 9.051]
, [new Date(2020,9,29,18,30,20), 124, 3.827]
, [new Date(2020,9,29,19,00,23), 37406, 20.309]
, [new Date(2020,9,29,19,30,25), 56051, 8.955]
, [new Date(2020,9,29,20,00,28), 135689, 20.2]
, [new Date(2020,9,29,20,30,31), 25269, 17.172]
, [new Date(2020,9,29,21,00,33), 43713, 7.006]
, [new Date(2020,9,30,18,30,19), 597, 5.934]
, [new Date(2020,9,30,19,00,22), 33317, 20.113]
, [new Date(2020,9,30,19,30,24), 77372, 7.82]
, [new Date(2020,9,30,20,00,27), 64549, 7.327]
, [new Date(2020,9,30,20,30,30), 27321, 7.668]
, [new Date(2020,9,30,21,00,33), 54518, 8.665]
, [new Date(2020,9,31,06,30,23), 257, 8.639]
, [new Date(2020,9,31,07,30,29), 1, 3]
, [new Date(2020,9,31,18,30,23), 121, 3.764]
, [new Date(2020,9,31,19,00,26), 25725, 8.535]
, [new Date(2020,9,31,19,30,32), 58693, 9.665]
, [new Date(2020,9,31,20,00,37), 85978, 7.606]
, [new Date(2020,9,31,20,30,40), 21224, 6.481]
, [new Date(2020,9,31,21,00,45), 49975, 8.645]
, [new Date(2020,9,31,21,30,49), 21476, 9.712]
, [new Date(2020,10,01,06,30,43), 882, 12.886]
, [new Date(2020,10,01,07,00,46), 3779, 74.324]
, [new Date(2020,10,01,17,30,35), 296, 5.13]
, [new Date(2020,10,01,18,00,37), 24094, 7.457]
, [new Date(2020,10,01,18,30,40), 99631, 8.911]
, [new Date(2020,10,01,19,00,42), 45256, 6.62]
, [new Date(2020,10,01,19,30,45), 50813, 8.119]
, [new Date(2020,10,01,20,00,03), 30622, 8.493]
, [new Date(2020,10,01,20,30,06), 305, 3.746]
, [new Date(2020,10,02,17,30,33), 8, .938]
, [new Date(2020,10,02,18,00,36), 23964, 7.121]
, [new Date(2020,10,02,18,30,04), 106920, 8.546]
, [new Date(2020,10,02,19,00,10), 40762, 7.042]
, [new Date(2020,10,02,19,30,13), 46799, 7.985]
, [new Date(2020,10,02,20,00,18), 51389, 9.497]
, [new Date(2020,10,03,17,30,12), 4, 2]
, [new Date(2020,10,03,18,00,15), 23908, 8.421]
, [new Date(2020,10,03,18,30,18), 52023, 7.5]
, [new Date(2020,10,03,19,00,21), 83487, 7.563]
, [new Date(2020,10,03,19,30,23), 43881, 22.232]
, [new Date(2020,10,03,20,00,26), 48402, 7.542]
, [new Date(2020,10,04,17,30,21), 148, 4.23]
, [new Date(2020,10,04,18,00,24), 21553, 7.172]
, [new Date(2020,10,04,18,30,29), 61304, 8.14]
, [new Date(2020,10,04,19,00,34), 81450, 7.863]
, [new Date(2020,10,04,19,30,38), 19931, 12.154]
, [new Date(2020,10,04,20,00,42), 54598, 9.417]
, [new Date(2020,10,05,17,30,43), 517, 5.008]
, [new Date(2020,10,05,18,00,46), 22580, 7.66]
, [new Date(2020,10,05,18,30,48), 82749, 8.483]
, [new Date(2020,10,05,19,00,51), 68188, 10.871]
, [new Date(2020,10,05,19,30,02), 27444, 18.072]
, [new Date(2020,10,05,20,00,06), 64730, 8.093]
]);

var options = {
chartArea:{left:120, top:80, width:'70%', height:'70%'},
backgroundColor: {fill: 'white', stroke: '#336699', strokeWidth: 1},
explorer: {actions: ['dragToZoom', 'rightClickToReset'], maxZoomIn: 0.01},
series: { 0: {targetAxisIndex: 0}, 1: {targetAxisIndex: 1} },
vAxes: { 0: {title: 'Waits Count', titleTextStyle: {fontSize: 16, bold: false}}, 1: {title: 'Average Latency in milliseconds', titleTextStyle: {fontSize: 16, bold: false}}},
vAxes: { 0: {textStyle: {color: 'royalblue'}, title: 'Waits Count', titleTextStyle: {color: 'royalblue', fontSize: 16, bold: false}},
1: {textStyle: {color: 'red'},       title: 'Average Latency in milliseconds', titleTextStyle: {color: 'red',       fontSize: 16, bold: false}}},
title: '4i.567. Scheduler "resmgr:cpu quantum" Waits Count and Average Latency',
titleTextStyle: {fontSize: 18, bold: false},
focusTarget: 'category',
legend: {position: 'right', textStyle: {fontSize: 14}},
tooltip: {textStyle: {fontSize: 14}},
hAxis: {title: ' 12.1.0.2.0 cores:16(avg) threads:16(avg) hosts:2(avg)', gridlines: {count: -1}, titleTextStyle: {fontSize: 16, bold: false}}
}

var chart = new google.visualization.LineChart(document.getElementById('linechart'))
chart.draw(data, options)
}
</script>
</head>
<body>

<h1> <a href="http://carlos-sierra.net/edb360-an-oracle-database-360-degree-view/" target="_blank"><img src="database.jpg" alt="eDB360" height="33" width="52" /></a> 4i.567. Scheduler "resmgr:cpu quantum" Waits Count and Average Latency <em>(DBA_HIST_EVENT_HISTOGRAM)</em>  </h1>

<br />


<br />

<div id="linechart" class="google-chart"></div>

<br />
<font class="n">Notes:<br />1) drag to zoom, and right click to reset<br />2) up to 31 days of awr history were considered</font>
<font class="n"><br />3) </font>
<pre>
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 SNAP_ID                                   NOT NULL NUMBER
 DBID                                      NOT NULL NUMBER
 INSTANCE_NUMBER                           NOT NULL NUMBER
 EVENT_ID                                  NOT NULL NUMBER
 EVENT_NAME                                NOT NULL VARCHAR2(64)
 WAIT_CLASS_ID                                      NUMBER
 WAIT_CLASS                                         VARCHAR2(64)
 WAIT_TIME_MILLI                           NOT NULL NUMBER
 WAIT_COUNT                                         NUMBER
 CON_DBID                                           NUMBER
 CON_ID                                             NUMBER

WITH
histogram AS (
SELECT /*+  MATERIALIZE NO_MERGE  */ /* 4i.562 */
       snap_id,
       dbid,
       instance_number,
       wait_time_milli,
       wait_count - LAG(wait_count) OVER (PARTITION BY dbid, instance_number, event_id, wait_class_id, wait_time_milli ORDER BY snap_id) wait_count_this_snap
  FROM dba_hist_event_histogram
 WHERE snap_id BETWEEN 3473 AND 4962
   AND dbid = 2109323688
   AND wait_class = TRIM('Scheduler') AND event_name = TRIM('resmgr:cpu quantum')
),
average AS (
SELECT /*+  MATERIALIZE NO_MERGE  */ /* 4i.562 */
       snap_id,
       dbid,
       instance_number,
       SUM(wait_count_this_snap) waits_count_this_snap,
       SUM((CASE wait_time_milli WHEN 1 THEN 0.50 ELSE 0.75 END) * wait_time_milli * wait_count_this_snap)/SUM(wait_count_this_snap) avg_wait_time_milli
  FROM histogram
 WHERE wait_count_this_snap &gt;= 0
 GROUP BY
       snap_id,
       dbid,
       instance_number
HAVING SUM(wait_count_this_snap) &gt; 0
),
per_inst AS (
SELECT /*+  MATERIALIZE NO_MERGE  */ /* 4i.562 */
       h.snap_id,
       s.begin_interval_time,
       s.end_interval_time,
       h.waits_count_this_snap,
       h.avg_wait_time_milli
  FROM average h,
       dba_hist_snapshot s
 WHERE s.snap_id         = h.snap_id
   AND s.dbid            = h.dbid
   AND s.instance_number = h.instance_number
)
SELECT snap_id,
       TO_CHAR(MIN(begin_interval_time), 'YYYY-MM-DD HH24:MI:SS') begin_time,
       TO_CHAR(MIN(end_interval_time), 'YYYY-MM-DD HH24:MI:SS') end_time,
       ROUND(SUM(waits_count_this_snap)) waits_count,
       ROUND(SUM(avg_wait_time_milli), 3) avg_latency_ms
  FROM per_inst
 GROUP BY
       snap_id
 ORDER BY
       snap_id;

196 rows selected.
</pre>

<br />
<font class="f">edb360 (c) 2019. Version v192 (2019-03-23). Timestamp: 2020-11-06T12:11:26  </font>
</body>
</html>
